<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yao.dao.ResumeMapper">
    <resultMap id="findResumeMap" type="Resume">
        <id property="resuID" column="resu_id"/>
        <result property="resuName" column="resu_name"/>
        <result property="resuSex" column="resu_sex"/>
        <result property="resuBirth" column="resu_birth"/>
        <result property="resuCity" column="resu_city"/>
        <result property="resuCell" column="resu_cell"/>
        <result property="resuInfo" column="resu_info"/>
        <result property="resuEmail" column="resu_email"/>
        <result property="resuStatus" column="resu_status"/>
        <result property="uid" column="resu_uid"/>
    </resultMap>

    <!--With Recruit-->
    <resultMap id="resumeRecruitMap" type="Resume" extends="findResumeMap">
        <collection property="recruits" ofType="Recruit">
            <id property="riid" column="ri_id"/>
            <result property="riName" column="ri_name"/>
            <result property="riCompany" column="ri_company"/>
            <result property="riSalary" column="ri_salary"/>
            <result property="riDuty" column="ri_duty"/>
            <result property="riDesired" column="ri_desired"/>
            <result property="riAddtion" column="ri_addtion"/>
            <result property="riLocation" column="ri_location"/>
        </collection>
    </resultMap>
    <insert id="saveResume">
        INSERT INTO T_HRSYS_RESUME (RESU_NAME, RESU_SEX, RESU_BIRTH, RESU_CITY, RESU_CELL, RESU_INFO, RESU_STATUS, RESU_UID, RESU_EMAIL)
        VALUES (#{resuName},#{resuSex},#{resuBirth},#{resuCity},#{resuCell},#{resuInfo},#{resuStatus},${uid},#{resuEmail})
    </insert>
    <update id="updateResume">
        UPDATE T_HRSYS_RESUME
        <set>
            <choose>
                <when test="resuName!=null and resuName!=''">
                    RESU_NAME = #{resuName}
                </when>
                <when test="resuSex!=null and resuSex!=''">
                    RESU_SEX = #{resuSex}
                </when>
                <when test="resuBirth!=null and resuBirth!=''">
                    RESU_BIRTH = #{resuBirth}
                </when>
                <when test="resuCity!=null and resuCity!=''">
                    RESU_CITY = #{resuCity}
                </when>
                <when test="resuCell!=null and resuCell!=''">
                    RESU_CELL = #{resuCell}
                </when>
                <when test="resuInfo!=null and resuInfo!=''">
                    RESU_INFO = #{resuInfo}
                </when>
                <when test="resuStatus!=null and resuStatus!=''">
                    RESU_STATUS = #{resuStatus}
                </when>
            </choose>
        </set>
        WHERE RESU_EMAIL=#{resuEmail}
    </update>
    <delete id="deleteResume"></delete>
    <select id="findThisResume" resultType="com.yao.model.Resume"></select>
    <select id="listMyPost" resultMap="resumeRecruitMap">
        SELECT re.* FROM T_HRSYS_RESUME rs JOIN T_HRSYS_POSTINTER po ON rs.RESU_ID=po.POST_RESU_ID JOIN T_HRSYS_RECRUITINF re ON po.POST_RI_ID=re.RI_ID
        WHERE rs.RESU_UID=#{arg0} AND po.POST_STATUS=#{arg1}

    </select>
    <insert id="postResume">
        INSERT INTO T_HRSYS_POSTINTER (POST_RI_ID, POST_RESU_ID, POST_STATUS)
        VALUES (#{arg0},#{arg1},#{arg2})
    </insert>
</mapper>